<style>
	.axis path,
	.axis line {
		fill: none;
		stroke: black;
		shape-rendering: crispEdges;
	}
	
	.axis text {
		font-family: sans-serif;
		font-size: 11px;
	}
	
	#canvas {    
		width:650px;
		height:600px;
		background:#fff;
		margin:0 0 0 0;
	}

		#canvas circle {
			cursor:pointer;
			opacity:0.5;
			fill:#f8981d;
		}		
		#canvas circle:nth-of-type(5) {
			cursor:pointer;
			opacity:0.5;
			fill:#78a22f;
		}
		#canvas circle:hover {
			z-index:1000;
			opacity:1;
		}		
	#y-axis {
		width:75px;
		height:400px;
		float:left;
		margin:10px 0 0 0;
	}
		#y-axis-label {
			width:25px;
			height:402px;
			margin:0 5px 0 5px;
			float:left;
		}
			#y-axis-label h4 {
				transform:rotate(270deg);
				-ms-transform:rotate(270deg);
				-o-transform:rotate(270deg);
				-moz-transform:rotate(270deg);
				-webkit-transform:rotate(270deg);
				width:402px;
				height:25px;
				text-align:center;
				background:#fff;
				left: -176px;
				top: 185px;
				position: absolute;
				font: 300 1em/1em "helvetica neue";
				color:#aaa;
			}
			#y-axis-ticks {
				background:pink;
				width:40px;
				height:402px;
				margin:0 0 0 0;
				float:left;
			}
	#x-axis {
		width:650px;
		height:75px;
		margin:0 0 0 0;
	}
		#x-axis-label {
			width:502px;
			height:25px;
			margin:5px 0 5px 76px;
		}
			#x-axis-label h4 {
				width:502px;
				height:25px;
				text-align:center;
				background:#fff;
				left: 84px;
				top: 452px;
				position: absolute;
				font: 300 1em/1em "helvetica neue";
				color:#aaa;
			}
		#x-axis-ticks {
			width:502px;
			height:40px;
			margin:-5px 0 0 76px;
			background:pink;
		}

	#upperarea {
		width:650px;
		height:400px;
		margin:0 0 18px 0;
	}

</style>
<div id="canvas"></div>     
<div id="navigation">
	<p>Update</p>
</div> 
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="http://www.edsource.org/wp-content/js/tabletop.js"></script>
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>


<script>	
	"use strict";
	//GLOBAL VARIABLES
	var public_spreadsheet_url = "https://docs.google.com/spreadsheet/pub?key=0AnZDmytGK63SdDZOUWRhVXRiSjVrMjlqNzlPR1BJc0E&output=html";
	var chartDump = [], workingData = [], pointLabel = [], scalingData = [], pointColors = [];
	var plotRadius = 10, initX = 1, initY = 2, padding = 50, widthX = 650, widthY = 600, color = "#f8981d", plotPoints = 51, chartStep = 0, years = 42;
	var plots, xScale, yScale, xAxis, yAxis;
	var canvas = d3.select("#canvas")
					.append("svg")
					.attr({
						width: widthX,
						height: widthY
					});

	$(document).ready(function(){
			Tabletop.init( { key: public_spreadsheet_url,
		                     callback: showInfo,
		                     wanted: ["Data"],
		                     debug: true } );
	});

	function showInfo(data, tabletop) {		
		$.each( tabletop.sheets("Data").all(), function(i, data) {
			var insertRow = [];
			insertRow[0] = data.label;
			insertRow[1] = parseFloat(data.data1);
			insertRow[2] = parseFloat(data.data2);
			chartDump.push(insertRow);
		});
		grabData();
		dataScale();
		initialPlot();
	}

	function grabData(){
		var i, cs;
		if (chartStep === 0 || chartStep === 1){
			cs = chartStep * plotPoints;
		}
		else {
			cs = (chartStep * plotPoints) - 1;
			console.log(cs)
		}
		for (i=0 ; i < plotPoints ; i++){
			var ii = i + cs;
			workingData[i] = new Array();
			workingData[i][0] = chartDump[ii][initX];
			workingData[i][1]= chartDump[ii][initY];
			pointLabel[i] = chartDump[ii][0];
		}
		console.log(workingData[4]);
		
	
	}
	
	function dataScale(){
		var i;
		var maxData = chartDump.length;
		
		for (i=0 ; i < maxData ; i++){
			scalingData[i] = new Array();
			scalingData[i][0] = chartDump[i][initX];
			scalingData[i][1]= chartDump[i][initY];
		}
		
		xScale = d3.scale.linear()
					.domain([0, d3.max(scalingData, function(d){return d[0];})])
					.range([padding, widthX - padding])
					.clamp(true)
					.nice();
					
		yScale = d3.scale.linear()
					.domain([0, d3.max(scalingData, function(d){return d[1];})])
					.range([widthY - padding, padding])
					.clamp(true)
					.nice();
					
		xAxis = d3.svg.axis()
					.scale(xScale)
					.orient("bottom")
					.ticks(5);
		
		yAxis = d3.svg.axis()
					.scale(yScale)
					.orient("left")
					.ticks(5);
					
	}
	
	function initialPlot(){
		plots = canvas.selectAll("circle")
						.data(workingData)
						.enter()
						.append("circle")
						.attr({
							r: plotRadius,
							cx: function(d){
								return xScale(d[0]);
							},
							cy: function(d){
								return yScale(d[1]);
							}
						})
		
		//create x-axis
		canvas.append("g")
			.classed("axis", true)
			.attr("transform", "translate(0," + (widthY - padding) + ")")
			.call(xAxis);			
						
		//create x-axis
		canvas.append("g")
			.classed("axis", true)
			.attr({
				transform: "translate(" + padding + ",0)",
			})
			.call(yAxis);		
	}
	
	//updating data
	d3.select("#navigation p")
		.on("click", function(){
			updateData();
		})
	
	function updateData(){
		chartStep = chartStep + 1;
		grabData();
		canvas.selectAll("circle")
			.data(workingData); //grab new data
		plots = canvas.selectAll("circle") //update visuals
						.data(workingData)
						.transition()
						.duration(1000)
						.attr({
							r: plotRadius,
							cx: function(d){
								return xScale(d[0]);
							},
							cy: function(d){
								return yScale(d[1]);
							}
						})
		if (chartStep === years){
			return;
		}
		else {
			setTimeout(updateData, 500);
		}
	}
	



</script>
